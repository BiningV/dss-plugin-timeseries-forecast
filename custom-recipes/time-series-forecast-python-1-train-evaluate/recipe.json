{
    "meta": {
        "label": "Train forecast models",
        "description": "Train forecast models and evaluate their performance on historical data",
        "icon": "icon-calendar",
        "displayOrderRank": 1
    },
    "kind": "PYTHON",
    "selectableFromDataset": "input_dataset",
    "inputRoles": [
        {
            "name": "input_dataset",
            "label": "Input dataset",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsFolder": false
        }
    ],
    "outputRoles": [
        {
            "name": "model_folder",
            "label": "Trained model folder",
            "description": "This folder will be used to store trained models.",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": false,
            "acceptsManagedFolder": true
        },
        {
            "name": "evaluation_dataset",
            "label": "Evaluation results",
            "description": "This dataset will store the results of model performance evaluation on historical data.",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsFolder": false
        },
        {
            "name": "evaluation_forecasts",
            "label": "Evaluation forecasts (optional)",
            "description": "This dataset stores train and test data along with the forecasts used to evaluate metrics.",
            "arity": "UNARY",
            "required": false,
            "acceptsDataset": true,
            "acceptsFolder": false
        }
    ],
    "params": [
        {
            "type": "SEPARATOR",
            "name": "separator_input",
            "label": "Input parameters"
        },
        {
            "name": "time_column",
            "label": "Time column",
            "allowedColumnTypes": [
                "date"
            ],
            "type": "COLUMN",
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "target_columns",
            "label": "Target column(s)",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "float",
                "double"
            ],
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "additional_columns",
            "label": "Additional columns?",
            "description": "",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true
        },
        {
            "name": "timeseries_identifiers",
            "label": "Timeseries identifiers",
            "description": "For long-format input data",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "string",
                "boolean"
            ],
            "columnRole": "input_dataset",
            "mandatory": false,
            "visibilityCondition": "model.additional_columns == true"
        },
        {
            "name": "external_feature_columns",
            "label": "External features",
            "description": "Used for training only by DeepAR and Transformer models",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "float",
                "double"
            ],
            "columnRole": "input_dataset",
            "mandatory": false,
            "visibilityCondition": "model.additional_columns == true"
        },
        {
            "name": "time_granularity_step",
            "label": "Time granularity step",
            "type": "INT",
            "defaultValue": 1,
            "mandatory": true,
            "minI": 1
        },
        {
            "name": "time_granularity_unit",
            "label": "Time granularity unit",
            "type": "SELECT",
            "mandatory": true,
            "selectChoices": [
                {
                    "value": "Y",
                    "label": "Year"
                },
                {
                    "value": "M",
                    "label": "Month"
                },
                {
                    "value": "W",
                    "label": "Week"
                },
                {
                    "value": "D",
                    "label": "Day"
                },
                {
                    "value": "B",
                    "label": "Business Day"
                },
                {
                    "value": "H",
                    "label": "Hour"
                },
                {
                    "value": "min",
                    "label": "Minute"
                }
            ],
            "defaultValue": "D"
        },
        {
            "name": "separator_modeling",
            "label": "Modeling",
            "type": "SEPARATOR"
        },
        {
            "name": "prediction_length",
            "label": "Forecast horizon",
            "type": "INT",
            "defaultValue": 1,
            "mandatory": true,
            "minI": 1
        },
        {
            "name": "forecasting_style",
            "label": "Forecast mode",
            "type": "SELECT",
            "mandatory": true,
            "selectChoices": [
                {
                    "value": "auto",
                    "label": "Auto"
                },
                {
                    "value": "expert",
                    "label": "Expert"
                }
            ],
            "defaultValue": "auto"
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'expert'"
        },
        {
            "name": "naive_model_activated",
            "label": "- Baseline",
            "description": "Based on the trivial/seasonal_naive/naive_2 GluonTS models",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true
        },
        {
            "name": "naive_model_method",
            "label": "  ↳ method",
            "type": "SELECT",
            "mandatory": true,
            "defaultValue": "trivial_identity",
            "visibilityCondition": "model.forecasting_style == 'expert' && model.naive_model_activated",
            "selectChoices": [
                {
                    "value": "trivial_identity",
                    "label": "Forecast preceding value"
                },
                {
                    "value": "trivial_mean",
                    "label": "Forecast average value"
                },
                {
                    "value": "seasonal_naive",
                    "label": "Forecast value at previous period with seasonal decomposition"
                }
            ]
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'expert'"
        },
        {
            "name": "simplefeedforward_model_activated",
            "label": "- FeedForward",
            "description": "Based on the SimpleFeedForwardEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true
        },
        {
            "name": "simplefeedforward_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional parameters cf. https://gluon-ts.mxnet.io/api/gluonts/gluonts.model.simple_feedforward.html",
            "visibilityCondition": "model.forecasting_style == 'expert' && model.simplefeedforward_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'expert'"
        },
        {
            "name": "deepar_model_activated",
            "label": "- DeepAR",
            "description": "Based on the DeepAREstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true
        },
        {
            "name": "deepar_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional parameters cf. https://gluon-ts.mxnet.io/api/gluonts/gluonts.model.deepar.html",
            "visibilityCondition": "model.forecasting_style == 'expert' && model.deepar_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'expert'"
        },
        {
            "name": "transformer_model_activated",
            "label": "- Transformer",
            "description": "Based on the TransformerEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true
        },
        {
            "name": "transformer_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional parameters cf. https://gluon-ts.mxnet.io/api/gluonts/gluonts.model.transformer.html",
            "visibilityCondition": "model.forecasting_style == 'expert' && model.transformer_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'expert'"
        },
        {
            "name": "nbeats_model_activated",
            "label": "- NBEATS",
            "description": "Based on the NBEATSEnsembleEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true
        },
        {
            "name": "nbeats_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional parameters cf. https://gluon-ts.mxnet.io/api/gluonts/gluonts.model.n_beats.html",
            "visibilityCondition": "model.forecasting_style == 'expert' && model.nbeats_model_activated",
            "mandatory": false
        },
        {
            "name": "separator_evaluation",
            "label": "Performance Evaluation",
            "type": "SEPARATOR"
        },
        {
            "name": "evaluation_strategy",
            "label": "Evaluation strategy",
            "type": "SELECT",
            "mandatory": true,
            "description": "Time-based split or backtesting based on GluonTS method (slower)",
            "selectChoices": [
                {
                    "value": "split",
                    "label": "Train/Test Split"
                }
            ],
            "defaultValue": "split"
        },
        {
            "name": "advanced_options_separator",
            "label": "Advanced",
            "type": "SEPARATOR"
        },
        {
            "name": "evaluation_only",
            "label": "Evaluation only",
            "description": "Store evaluation results but do not save trained models",
            "type": "BOOLEAN",
            "defaultValue": false
        },
        {
            "name": "advanced_options",
            "label": "Display advanced training options?",
            "type": "BOOLEAN",
            "defaultValue": false
        },
        {
            "name": "training_options_separator",
            "label": "Training options",
            "type": "SEPARATOR",
            "visibilityCondition": "model.advanced_options == true"
        },
        {
            "name": "epoch",
            "label": "Epoch",
            "type": "INT",
            "defaultValue": 1,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "model.advanced_options == true"
        },
        {
            "name": "context_length",
            "label": "Context length",
            "type": "INT",
            "description": "If 0, same as prediction length.",
            "defaultValue": 0,
            "mandatory": false,
            "minI": 0,
            "visibilityCondition": "model.advanced_options == true"
        },
        {
            "name": "batch_size",
            "label": "Batch size",
            "type": "INT",
            "description": "",
            "defaultValue": 32,
            "mandatory": false,
            "minI": 0,
            "visibilityCondition": "model.advanced_options == true"
        },
        {
            "name": "gpu",
            "label": "GPU",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "no_gpu",
                    "label": "No GPU"
                }
            ],
            "defaultValue": "no_gpu",
            "visibilityCondition": "false"
        }
    ],
    "resourceKeys": []
}