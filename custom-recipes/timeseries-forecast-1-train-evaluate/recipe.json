{
    "meta": {
        "label": "1. Train and test forecasting models",
        "description": "Train forecasting models and test their performance on historical data",
        "icon": "icon-calendar",
        "displayOrderRank": 1
    },
    "kind": "PYTHON",
    "selectableFromDataset": "input_dataset",
    "inputRoles": [
        {
            "name": "input_dataset",
            "label": "Historical dataset",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsManagedFolder": false
        }
    ],
    "outputRoles": [
        {
            "name": "model_folder",
            "label": "Trained model folder",
            "description": "Folder to save trained forecasting models",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": false,
            "acceptsManagedFolder": true
        },
        {
            "name": "evaluation_dataset",
            "label": "Performance metrics dataset",
            "description": "Performance metrics of forecasting models evaluated on the historical dataset (splitting strategy can be specified in the recipe settings) ",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsManagedFolder": false
        },
        {
            "name": "evaluation_forecasts_dataset",
            "label": "Evaluation dataset",
            "description": "Dataset with evaluation forecasts used to compute the performance metrics",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsManagedFolder": false
        }
    ],
    "params": [
        {
            "type": "SEPARATOR",
            "name": "separator_input",
            "label": "Input parameters"
        },
        {
            "name": "time_column",
            "label": "Time column",
            "allowedColumnTypes": [
                "date"
            ],
            "type": "COLUMN",
            "description": "Must be a parsed date",
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "frequency_unit",
            "label": "Frequency",
            "type": "SELECT",
            "description": "Frequency of your historical data",
            "mandatory": true,
            "selectChoices": [
                {
                    "value": "min",
                    "label": "Minute"
                },
                {
                    "value": "H",
                    "label": "Hour"
                },
                {
                    "value": "D",
                    "label": "Day"
                },
                {
                    "value": "B",
                    "label": "Business Day (Mon-Fri)"
                },
                {
                    "value": "W",
                    "label": "Week"
                },
                {
                    "value": "M",
                    "label": "Month"
                },
                {
                    "value": "3M",
                    "label": "Quarter"
                },
                {
                    "value": "6M",
                    "label": "Semester"
                },
                {
                    "value": "A",
                    "label": "Year"
                }
            ],
            "defaultValue": "D"
        },
        {
            "name": "frequency_end_of_year",
            "label": "End of year month",
            "type": "SELECT",
            "mandatory": false,
            "defaultValue": "DEC",
            "visibilityCondition": "model.frequency_unit == 'A'",
            "selectChoices": [
                {
                    "value": "JAN",
                    "label": "January"
                },
                {
                    "value": "FEB",
                    "label": "February"
                },
                {
                    "value": "MAR",
                    "label": "March"
                },
                {
                    "value": "APR",
                    "label": "April"
                },
                {
                    "value": "MAY",
                    "label": "May"
                },
                {
                    "value": "JUN",
                    "label": "June"
                },
                {
                    "value": "JUL",
                    "label": "July"
                },
                {
                    "value": "AUG",
                    "label": "August"
                },
                {
                    "value": "SEP",
                    "label": "September"
                },
                {
                    "value": "OCT",
                    "label": "October"
                },
                {
                    "value": "NOV",
                    "label": "November"
                },
                {
                    "value": "DEC",
                    "label": "December"
                }
            ]
        },
        {
            "name": "frequency_end_of_week",
            "label": "End of week day",
            "type": "SELECT",
            "mandatory": false,
            "defaultValue": "SUN",
            "visibilityCondition": "model.frequency_unit == 'W'",
            "selectChoices": [
                {
                    "value": "SUN",
                    "label": "Sunday"
                },
                {
                    "value": "MON",
                    "label": "Monday"
                },
                {
                    "value": "TUE",
                    "label": "Tuesday"
                },
                {
                    "value": "WED",
                    "label": "Wednesday"
                },
                {
                    "value": "THU",
                    "label": "Thursday"
                },
                {
                    "value": "FRI",
                    "label": "Friday"
                },
                {
                    "value": "SAT",
                    "label": "Saturday"
                }
            ]
        },
        {
            "name": "frequency_step_hours",
            "label": "Number of hours",
            "type": "INT",
            "defaultValue": 1,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "model.frequency_unit == 'H'"
        },
        {
            "name": "frequency_step_minutes",
            "label": "Number of minutes",
            "type": "INT",
            "defaultValue": 1,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "model.frequency_unit == 'min'"
        },
        {
            "name": "target_columns",
            "label": "Target column(s)",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "float",
                "double"
            ],
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "additional_columns",
            "label": "Long format",
            "description": "If multiple time series are stored in the same column",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true
        },
        {
            "name": "timeseries_identifiers",
            "label": "Time series identifiers",
            "description": "Columns that identify the multiple time series - mandatory for long format",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "string",
                "boolean"
            ],
            "columnRole": "input_dataset",
            "mandatory": false,
            "visibilityCondition": "model.additional_columns"
        },
        {
            "name": "separator_modeling",
            "label": "Modeling",
            "type": "SEPARATOR"
        },
        {
            "name": "separator_modeling_customize_algorithms",
            "label": "",
            "type": "SEPARATOR",
            "description": "Detailed documentation: https://ts.gluon.ai/api/gluonts/gluonts.model.html",
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "prediction_length",
            "label": "Forecasting horizon",
            "type": "INT",
            "description": "Number of future values to predict. Higher values increase runtime.",
            "defaultValue": 1,
            "mandatory": true,
            "minI": 1
        },
        {
            "name": "forecasting_style",
            "label": "Forecasting mode",
            "type": "SELECT",
            "description": "AutoML to let Dataiku choose your models or Expert to have full control.",
            "mandatory": true,
            "selectChoices": [
                {
                    "value": "auto",
                    "label": "AutoML - Quick Prototypes"
                },
                {
                    "value": "auto_performance",
                    "label": "AutoML - High Performance"
                },
                {
                    "value": "choose_algorithms",
                    "label": "Expert - Choose Algorithms"
                },
                {
                    "value": "customize_algorithms",
                    "label": "Expert - Customize Algorithms"
                }
            ],
            "defaultValue": "auto"
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "type": "SEPARATOR",
            "label": " ",
            "description": "Statistical models",
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "trivial_identity_model_activated",
            "label": "- Trivial Identity",
            "description": "Based on the trivial.identity GluonTS models",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "seasonal_naive_model_activated",
            "label": "- Seasonal Naive",
            "description": "Based on the seasonal_naive GluonTS models, compute seasonality based on the frequency",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "type": "SEPARATOR",
            "label": " ",
            "description": "Deep Learning models",
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "simplefeedforward_model_activated",
            "label": "- FeedForward",
            "description": "Based on the SimpleFeedForwardEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true,
            "visibilityCondition": "false && model.simplefeedforward_model_activated"
        },
        {
            "name": "simplefeedforward_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional keyword arguments from https://ts.gluon.ai/api/gluonts/gluonts.model.simple_feedforward.html",
            "visibilityCondition": "false",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "deepar_model_activated",
            "label": "- DeepAR",
            "description": "Based on the DeepAREstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": true,
            "mandatory": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "deepar_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional keyword arguments from https://ts.gluon.ai/api/gluonts/gluonts.model.deepar.html",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms' && model.deepar_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "transformer_model_activated",
            "label": "- Transformer",
            "description": "Based on the TransformerEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "transformer_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional keyword arguments from https://ts.gluon.ai/api/gluonts/gluonts.model.transformer.html",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms' && model.transformer_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "tft_model_activated",
            "label": "- TFT",
            "description": "Based on the TemporalFusionTransformer GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true,
            "visibilityCondition": "false && ['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "tft_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "No documentation available yet",
            "visibilityCondition": "false && model.forecasting_style == 'customize_algorithms' && model.tft_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "false && model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "nbeats_model_activated",
            "label": "- NBEATS",
            "description": "Based on the NBEATSEnsembleEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true,
            "visibilityCondition": "false && ['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "nbeats_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional keyword arguments from https://ts.gluon.ai/api/gluonts/gluonts.model.n_beats.html",
            "visibilityCondition": "false && model.forecasting_style == 'customize_algorithms' && model.nbeats_model_activated",
            "mandatory": false
        },
        {
            "type": "SEPARATOR",
            "visibilityCondition": "false && model.forecasting_style == 'customize_algorithms'"
        },
        {
            "name": "mqcnn_model_activated",
            "label": "- MQ-CNN",
            "description": "Based on the MQCNNEstimator GluonTS model",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "mqcnn_model_kwargs",
            "type": "MAP",
            "label": "  ↳ Parameters",
            "description": "Optional keyword arguments from https://ts.gluon.ai/api/gluonts/gluonts.model.seq2seq.html",
            "visibilityCondition": "model.forecasting_style == 'customize_algorithms' && model.mqcnn_model_activated",
            "mandatory": false
        },
        {
            "name": "training_options_separator",
            "label": "Training options",
            "type": "SEPARATOR",
            "description": "Detailed documentation: https://ts.gluon.ai/api/gluonts/gluonts.trainer.html",
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "context_length",
            "label": "Context length",
            "type": "INT",
            "description": "Number of input lags. If -1, same as forecasting horizon. Higher values increase runtime.",
            "defaultValue": -1,
            "mandatory": false,
            "minI": -1,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "epoch",
            "label": "Number of epochs",
            "description": "Higher values increase performance but increase runtime linearly",
            "type": "INT",
            "defaultValue": 10,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "batch_size",
            "label": "Batch size",
            "description": "Higher values may reduce runtime but decrease performance",
            "type": "INT",
            "defaultValue": 32,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "auto_num_batches_per_epoch",
            "label": "Sample all data",
            "description": "Automatically choose the number of batches per epoch to sample all data in one epoch",
            "type": "BOOLEAN",
            "defaultValue": true,
            "visibilityCondition": "['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "num_batches_per_epoch",
            "label": "Number of batches per epoch",
            "description": "Number of training batches used in one epoch. Higher values increase runtime",
            "type": "INT",
            "defaultValue": 50,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "(model.auto_num_batches_per_epoch==false) && ['choose_algorithms', 'customize_algorithms'].includes(model.forecasting_style)"
        },
        {
            "name": "separator_evaluation",
            "label": "Train / Test Set",
            "type": "SEPARATOR"
        },
        {
            "name": "sampling_method",
            "label": "Sampling method",
            "type": "SELECT",
            "mandatory": true,
            "description": "",
            "selectChoices": [
                {
                    "value": "last_records",
                    "label": "Last records (most recent)"
                },
                {
                    "value": "no_sampling",
                    "label": "No sampling (whole data)"
                }
            ],
            "defaultValue": "last_records"
        },
        {
            "name": "number_records",
            "label": "Nb. records",
            "description": "Number of records to use per timeseries",
            "type": "INT",
            "defaultValue": 10000,
            "mandatory": false,
            "minI": 1,
            "visibilityCondition": "model.sampling_method=='last_records'"
        },
        {
            "name": "evaluation_strategy",
            "label": "Splitting strategy",
            "type": "SELECT",
            "mandatory": true,
            "description": "Only supported method - Test set will have \"Forecasting horizon\" values",
            "selectChoices": [
                {
                    "value": "split",
                    "label": "Time-based Split"
                }
            ],
            "defaultValue": "split"
        },
        {
            "name": "advanced_options_separator",
            "label": "Advanced",
            "type": "SEPARATOR"
        },
        {
            "name": "external_feature_activated",
            "label": "Add external features",
            "description": "External features - e.g., holidays, special events",
            "type": "BOOLEAN",
            "defaultValue": false
        },
        {
            "name": "external_feature_columns",
            "label": "External features",
            "description": "Optional ⚠️  Futures values of external features will be required to forecast.",
            "type": "COLUMNS",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "float",
                "double"
            ],
            "columnRole": "input_dataset",
            "mandatory": false,
            "visibilityCondition": "model.external_feature_activated"
        },
        {
            "name": "evaluation_only",
            "label": "Evaluation only",
            "description": "Store evaluation results but do not save trained models",
            "type": "BOOLEAN",
            "defaultValue": false,
            "visibilityCondition": "false"
        },
        {
            "name": "gpu",
            "label": "GPU",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "no_gpu",
                    "label": "No GPU"
                }
            ],
            "defaultValue": "no_gpu",
            "visibilityCondition": "false"
        }
    ],
    "resourceKeys": []
}
